<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Projet Arrosage ‚Äî Nathan & L√©o</title>

  <!-- ‚úÖ √©vite le 404 favicon.ico -->
  <link rel="icon" type="image/svg+xml"
        href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Crect width='64' height='64' rx='14' fill='%23072a55'/%3E%3Cpath d='M32 10s14 16 14 28a14 14 0 1 1-28 0c0-12 14-28 14-28z' fill='%236fb6ff'/%3E%3Ccircle cx='24' cy='42' r='3' fill='white' fill-opacity='.8'/%3E%3C/svg%3E" />

  <style>
    :root{
      --bg1:#041325; --bg2:#072a55; --bg3:#0b4f86;
      --txt: rgba(255,255,255,.95);
      --muted: rgba(255,255,255,.72);
      --accent:#6fb6ff; --accent2:#66e6b3;
      --shadow: 0 22px 60px rgba(0,0,0,.48);
      --shadow2: 0 14px 34px rgba(0,0,0,.36);
      --r: 20px;
    }

    *{box-sizing:border-box;}
    html,body{height:100%;}

    body{
      margin:0;
      height:100vh;
      overflow:hidden;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color: var(--txt);
      background:
        radial-gradient(1100px 650px at 15% 10%, rgba(111,182,255,.33), transparent 55%),
        radial-gradient(900px 600px at 85% 0%, rgba(102,230,179,.18), transparent 55%),
        radial-gradient(900px 700px at 50% 110%, rgba(11,79,134,.62), transparent 55%),
        linear-gradient(135deg, var(--bg1), var(--bg2), var(--bg3));
    }

    /* petites gouttes */
    body::before{
      content:"";
      position:fixed; inset:0;
      pointer-events:none;
      opacity:.28;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='520' height='520' viewBox='0 0 520 520'%3E%3Cg fill='white' fill-opacity='.55'%3E%3Cpath d='M70 92c0-14 15-28 15-28s15 14 15 28c0 10-7 19-15 19s-15-9-15-19z'/%3E%3Cpath d='M168 160c0-12 13-24 13-24s13 12 13 24c0 9-6 16-13 16s-13-7-13-16z'/%3E%3Cpath d='M340 110c0-15 16-30 16-30s16 15 16 30c0 11-7 20-16 20s-16-9-16-20z'/%3E%3Cpath d='M448 210c0-12 13-24 13-24s13 12 13 24c0 9-6 16-13 16s-13-7-13-16z'/%3E%3Cpath d='M110 360c0-12 13-24 13-24s13 12 13 24c0 9-6 16-13 16s-13-7-13-16z'/%3E%3Cpath d='M250 430c0-14 15-28 15-28s15 14 15 28c0 10-7 19-15 19s-15-9-15-19z'/%3E%3Cpath d='M410 390c0-12 13-24 13-24s13 12 13 24c0 9-6 16-13 16s-13-7-13-16z'/%3E%3C/g%3E%3C/svg%3E");
      background-size: 240px 240px;
      filter: blur(.22px);
    }

    /* tuyaux + goutteurs + gouttes */
    body::after{
      content:"";
      position:fixed; inset:-30px;
      pointer-events:none;
      opacity:.26;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='1400' height='900' viewBox='0 0 1400 900'%3E%3Cdefs%3E%3ClinearGradient id='p' x1='0' y1='0' x2='1' y2='1'%3E%3Cstop offset='0' stop-color='%23ffffff' stop-opacity='.55'/%3E%3Cstop offset='1' stop-color='%236fb6ff' stop-opacity='.35'/%3E%3C/linearGradient%3E%3C/defs%3E%3Cg fill='none' stroke='url(%23p)' stroke-linecap='round'%3E%3Cpath d='M-40 160 C 180 50, 360 70, 540 170 S 880 300, 1060 190 S 1260 40, 1460 150' stroke-width='18'/%3E%3Cpath d='M-60 760 C 200 610, 420 650, 620 780 S 920 940, 1160 770 S 1340 620, 1460 720' stroke-width='16' stroke-opacity='.75'/%3E%3Cpath d='M240 -60 C 280 120, 280 220, 220 340 S 120 600, 220 740 S 320 980, 260 940' stroke-width='14' stroke-opacity='.55'/%3E%3Cpath d='M1180 -60 C 1120 120, 1120 220, 1200 340 S 1320 620, 1200 760 S 1080 980, 1140 940' stroke-width='14' stroke-opacity='.55'/%3E%3C/g%3E%3Cg fill='%23ffffff' fill-opacity='.55'%3E%3Ccircle cx='320' cy='128' r='6'/%3E%3Ccircle cx='520' cy='170' r='6'/%3E%3Ccircle cx='760' cy='240' r='6'/%3E%3Ccircle cx='980' cy='210' r='6'/%3E%3Ccircle cx='440' cy='730' r='6'/%3E%3Ccircle cx='700' cy='812' r='6'/%3E%3Ccircle cx='980' cy='820' r='6'/%3E%3C/g%3E%3Cg fill='%23ffffff' fill-opacity='.35'%3E%3Cpath d='M330 150c0-7 7-14 7-14s7 7 7 14c0 5-3 9-7 9s-7-4-7-9z'/%3E%3Cpath d='M530 195c0-7 7-14 7-14s7 7 7 14c0 5-3 9-7 9s-7-4-7-9z'/%3E%3Cpath d='M770 265c0-7 7-14 7-14s7 7 7 14c0 5-3 9-7 9s-7-4-7-9z'/%3E%3Cpath d='M990 235c0-7 7-14 7-14s7 7 7 14c0 5-3 9-7 9s-7-4-7-9z'/%3E%3Cpath d='M450 756c0-7 7-14 7-14s7 7 7 14c0 5-3 9-7 9s-7-4-7-9z'/%3E%3Cpath d='M710 840c0-7 7-14 7-14s7 7 7 14c0 5-3 9-7 9s-7-4-7-9z'/%3E%3Cpath d='M990 848c0-7 7-14 7-14s7 7 7 14c0 5-3 9-7 9s-7-4-7-9z'/%3E%3C/g%3E%3C/svg%3E");
      background-size: cover;
      background-position: center;
      filter: blur(.35px);
    }

    .page{height:100vh; display:flex; flex-direction:column;}

    header{
      flex:0 0 auto;
      backdrop-filter: blur(10px);
      background: rgba(0,0,0,.26);
      border-bottom: 1px solid rgba(255,255,255,.14);
      padding: 12px 18px;
      text-align:center;
    }
    .titleTop{
      margin:0;
      font-weight:1000;
      letter-spacing:.3px;
      font-size: clamp(28px, 5vw, 52px);
      line-height:1.05;
      text-shadow: 0 10px 26px rgba(0,0,0,.40);
    }
    .subTop{margin:6px 0 0; color:var(--muted); font-size:14px;}

    main{
      flex:1 1 auto;
      overflow:hidden;
      padding: 12px 18px 18px;
      display:flex;
      justify-content:center;
      align-items:stretch;
    }

    .card{
      width:min(1200px, 100%);
      height:100%;
      border:1px solid rgba(255,255,255,.22);
      border-radius: var(--r);
      background: rgba(255,255,255,.14);
      box-shadow: var(--shadow);
      overflow:hidden;
      display:flex;
      flex-direction:column;
      backdrop-filter: blur(10px);
    }
    .card .hd{
      padding:12px 14px;
      border-bottom:1px solid rgba(255,255,255,.16);
      display:flex;
      justify-content:space-between;
      align-items:center;
      background: rgba(0,0,0,.12);
    }
    .card h2{margin:0; font-size:16px;}
    .muted{color:var(--muted);}
    .card .bd{flex:1 1 auto; padding: 12px 14px; overflow:hidden;}

    .map{
      position:relative;
      height:100%;
      border-radius: 18px;
      background: linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,.06));
      overflow:hidden;
      border: 1px solid rgba(255,255,255,.18);
    }

    /* ‚úÖ IMPORTANT : le SVG au-dessus des cartes (sinon la grosse ombre du centre ‚Äúmange‚Äù la branche M√©dias) */
    .lines{
      position:absolute; inset:0;
      width:100%; height:100%;
      pointer-events:none;
      opacity:1;
      z-index:6; /* ‚úÖ au-dessus des .node (z-index:2) */
    }

    .node{
      position:absolute;
      width:255px;
      padding:12px;
      border-radius:20px;
      border:1px solid rgba(255,255,255,.26);
      background: rgba(0,0,0,.30);
      box-shadow: var(--shadow2);
      backdrop-filter: blur(8px);
      z-index:2;
    }
    .node .t{font-weight:1000; margin-bottom:6px;}
    .node .d{font-size:13px; color:var(--muted); margin-bottom:10px;}
    .node .links{display:flex; flex-wrap:wrap; gap:8px;}

    .pill{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding:8px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.24);
      background: rgba(255,255,255,.08);
      text-decoration:none;
      font-size:13px;
      white-space:nowrap;
      color: var(--txt);
    }
    .pill:hover{background: rgba(255,255,255,.12); border-color: rgba(255,255,255,.32);}
    .pill.blue{border-color: rgba(111,182,255,.70);}
    .pill.green{border-color: rgba(102,230,179,.65);}

    .center{
      left:50%; top:50%;
      transform: translate(-50%, -50%);
      width:390px;
      padding:16px;
      background: linear-gradient(180deg, rgba(111,182,255,.28), rgba(0,0,0,.30));
      border-color: rgba(111,182,255,.55);
    }
    .center .t{font-size:20px;}
    .center .d{font-size:14px;}

    /* ‚úÖ remonte un peu les 4 cartes */
    .n-recherche{ left:4%;  top:7%; }
    .n-onshape  { right:4%; top:9%; }
    .n-besoin   { left:4%;  top:56%; }
    .n-planning { right:4%; top:56%; }

    /* M√©dias au centre bas */
    .n-medias   { left:50%; top:90%; transform: translate(-50%, -50%); width:390px; }

    .fab{
      position: fixed;
      right: 16px;
      bottom: 16px;
      display:flex;
      gap:10px;
      z-index: 20;
    }
    .fab a{
      display:inline-flex;
      align-items:center;
      gap:10px;
      padding: 10px 12px;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,.22);
      background: rgba(0,0,0,.32);
      backdrop-filter: blur(10px);
      text-decoration:none;
      color: var(--txt);
      box-shadow: 0 12px 28px rgba(0,0,0,.30);
      font-weight: 700;
      font-size: 13px;
    }
    .fab .zip{border-color: rgba(111,182,255,.60);}
    .fab .repo{border-color: rgba(102,230,179,.60);}
  </style>
</head>

<body>
  <div class="page">
    <header>
      <h1 class="titleTop">Projet Arrosage ‚Äî Nathan & L√©o</h1>
      <p class="subTop">Carte mentale du projet (Onshape ‚Ä¢ besoin ‚Ä¢ m√©dias ‚Ä¢ planning)</p>
    </header>

    <main>
      <section class="card">
        <div class="hd">
          <h2>üß† Carte mentale</h2>
          <span class="muted">Clique sur les branches</span>
        </div>

        <div class="bd">
          <div class="map" id="map">

            <svg class="lines" id="lines" aria-hidden="true" preserveAspectRatio="none">
              <defs>
                <linearGradient id="g" x1="0" y1="0" x2="1" y2="1">
                  <stop offset="0" stop-color="#6fb6ff" stop-opacity=".98"/>
                  <stop offset="1" stop-color="#66e6b3" stop-opacity=".90"/>
                </linearGradient>

                <filter id="glow">
                  <feGaussianBlur stdDeviation="2.2" result="b"/>
                  <feMerge>
                    <feMergeNode in="b"/>
                    <feMergeNode in="SourceGraphic"/>
                  </feMerge>
                </filter>

                <!-- ‚úÖ Masque: on affiche tout en blanc, puis on ‚Äúd√©coupe‚Äù des trous noirs sous les cartes -->
                <mask id="cutNodes" maskUnits="userSpaceOnUse">
                  <rect id="cut-bg" x="0" y="0" width="1" height="1" fill="white"></rect>
                  <!-- les rectangles noirs (trous) sont ajout√©s par le JS -->
                </mask>
              </defs>
              <!-- ‚úÖ le JS cr√©e automatiquement tous les traits/points -->
            </svg>

            <!-- ‚úÖ carte centrale : sans boutons -->
            <div class="node center" id="node-center">
              <div class="t">Projet Arrosage</div>
              <div class="d">De l‚Äôexistant ‚Üí besoin ‚Üí conception ‚Üí planning ‚Üí r√©alisation.</div>
            </div>

            <div class="node n-recherche" id="node-recherche">
              <div class="t">üîé Recherche de l‚Äôexistant</div>
              <div class="d">Carte mentale / √©tat des lieux.</div>
              <div class="links">
                <a class="pill blue" target="_blank" rel="noopener"
                   href="https://nathanjammes-lab.github.io/Projet_Arosage/carte%20mentale/MVHtmlExport/index.htm">
                  Ouvrir
                </a>
              </div>
            </div>

            <div class="node n-besoin" id="node-besoin">
              <div class="t">üßæ Besoin / analyse</div>
              <div class="d">Cahier des charges, contraintes.</div>
              <div class="links">
                <a class="pill blue" target="_blank" rel="noopener"
                   href="https://raw.githubusercontent.com/nathanjammes-lab/Projet_Arosage/refs/heads/main/analyse_besoin/analyse_besoin.jpg">
                  Voir (image)
                </a>
              </div>
            </div>

            <div class="node n-onshape" id="node-onshape">
              <div class="t">üß© Conception Onshape</div>
              <div class="d">Pi√®ces mod√©lis√©es (liens directs).</div>
              <div class="links">
                <a class="pill green" target="_blank" rel="noopener"
                   href="https://cad.onshape.com/documents/1ebdcbd39435717654714584/w/061c80a41a81f831c6c7d309/e/0c81dac8944d71dc4b8938b5?renderMode=0&uiState=69844dcf7efa5709870f5401">
                  Pi√®ce 1
                </a>
                <a class="pill green" target="_blank" rel="noopener"
                   href="https://cad.onshape.com/documents/1d237ad3dc8cacce2a01fc8e/w/529bf12c2ad7c537813b41eb/e/0f21f78a75b64e775cbfc654?renderMode=0&leftPanel=false&uiState=6984566eff47f1cb9f37d8b2">
                  Pi√®ce 2
                </a>
              </div>
            </div>

            <div class="node n-planning" id="node-planning">
              <div class="t">üìÖ Planning</div>
              <div class="d">GanttProject (.gan) + suivi.</div>
              <div class="links">
                <a class="pill blue" href="projet_arrossage/planning_ganttproject/projet_arrossage.gan">T√©l√©charger .gan</a>
                <a class="pill blue" target="_blank" rel="noopener"
                   href="https://github.com/nathanjammes-lab/Projet_Arrosage_Nathan_Leo/tree/main/projet_arrossage/planning_ganttproject">
                  Voir dossier
                </a>
              </div>
            </div>

            <div class="node n-medias" id="node-medias">
              <div class="t">üì∑ M√©dias</div>
              <div class="d">Croquis, programme, sch√©ma, vid√©o.</div>
              <div class="links">
                <a class="pill blue" href="autres_fichiers/Croquis.jpg">Croquis</a>
                <a class="pill blue" href="autres_fichiers/Programe.png">Programme</a>
                <a class="pill blue" href="autres_fichiers/Systeme_d_arrosage_FINI.drawio.png">Sch√©ma</a>
                <a class="pill green" href="autres_fichiers/video.mp4">Vid√©o</a>
              </div>
            </div>

          </div>
        </div>
      </section>
    </main>

    <div class="fab">
      <a class="repo" href="https://github.com/nathanjammes-lab/Projet_Arrosage_Nathan_Leo" target="_blank" rel="noopener">‚Üó D√©p√¥t GitHub</a>
      <a class="zip"  href="https://github.com/nathanjammes-lab/Projet_Arrosage_Nathan_Leo/archive/refs/heads/main.zip" target="_blank" rel="noopener">‚¨á ZIP</a>
    </div>
  </div>

  <script>
    const PAD = 10;
    const CUT_PAD = 10; // marge autour des cartes ‚Äútrou√©es‚Äù (reste <= PAD)

    function must(id){
      const el = document.getElementById(id);
      if(!el) throw new Error("√âl√©ment manquant: " + id);
      return el;
    }

    function rectRel(el, rootRect){
      const r = el.getBoundingClientRect();
      return {
        left: r.left - rootRect.left,
        top: r.top - rootRect.top,
        right: r.right - rootRect.left,
        bottom: r.bottom - rootRect.top,
        width: r.width,
        height: r.height,
        cx: (r.left - rootRect.left) + r.width/2,
        cy: (r.top - rootRect.top) + r.height/2
      };
    }

    function edgePoint(rect, tx, ty){
      const cx = rect.cx, cy = rect.cy;
      const dx = tx - cx, dy = ty - cy;
      const EPS = 1e-6;
      const candidates = [];

      if (Math.abs(dx) > EPS){
        let t = (rect.left - cx) / dx;
        let y = cy + t*dy;
        if (t > 0 && y >= rect.top && y <= rect.bottom) candidates.push({t, x: rect.left, y});
        t = (rect.right - cx) / dx;
        y = cy + t*dy;
        if (t > 0 && y >= rect.top && y <= rect.bottom) candidates.push({t, x: rect.right, y});
      }

      if (Math.abs(dy) > EPS){
        let t = (rect.top - cy) / dy;
        let x = cx + t*dx;
        if (t > 0 && x >= rect.left && x <= rect.right) candidates.push({t, x, y: rect.top});
        t = (rect.bottom - cy) / dy;
        x = cx + t*dx;
        if (t > 0 && x >= rect.left && x <= rect.right) candidates.push({t, x, y: rect.bottom});
      }

      candidates.sort((a,b)=>a.t-b.t);
      const hit = candidates[0] || {x: cx, y: cy};

      const len = Math.hypot(dx, dy) || 1;
      const ux = dx/len, uy = dy/len;

      return { x: hit.x + ux*PAD, y: hit.y + uy*PAD };
    }

    function bezierPath(a, b){
      const dx = b.x - a.x;
      const dy = b.y - a.y;

      if (Math.abs(dx) >= Math.abs(dy)){
        const bend = Math.min(220, Math.abs(dx) * 0.40);
        const s = Math.sign(dx) || 1;
        const c1 = { x: a.x + s*bend, y: a.y };
        const c2 = { x: b.x - s*bend, y: b.y };
        return `M ${a.x} ${a.y} C ${c1.x} ${c1.y}, ${c2.x} ${c2.y}, ${b.x} ${b.y}`;
      } else {
        const bend = Math.min(210, Math.abs(dy) * 0.40);
        const s = Math.sign(dy) || 1;
        const c1 = { x: a.x, y: a.y + s*bend };
        const c2 = { x: b.x, y: b.y - s*bend };
        return `M ${a.x} ${a.y} C ${c1.x} ${c1.y}, ${c2.x} ${c2.y}, ${b.x} ${b.y}`;
      }
    }

    const SVG_NS = "http://www.w3.org/2000/svg";

    // ‚úÖ masque: on ‚Äútroue‚Äù sous les cartes pour √©viter que les traits passent dessus
    function ensureCutMask(rootRect){
      const svg = must("lines");
      const defs = svg.querySelector("defs");
      let mask = svg.querySelector("#cutNodes");
      if(!mask){
        // au cas o√π (mais dans notre HTML il existe d√©j√†)
        mask = document.createElementNS(SVG_NS, "mask");
        mask.setAttribute("id", "cutNodes");
        mask.setAttribute("maskUnits", "userSpaceOnUse");
        const bg = document.createElementNS(SVG_NS, "rect");
        bg.setAttribute("id", "cut-bg");
        bg.setAttribute("fill", "white");
        mask.appendChild(bg);
        defs.appendChild(mask);
      }

      const bg = mask.querySelector("#cut-bg");
      bg.setAttribute("x", "0");
      bg.setAttribute("y", "0");
      bg.setAttribute("width", String(rootRect.width));
      bg.setAttribute("height", String(rootRect.height));

      // supprime les anciens ‚Äútrous‚Äù
      mask.querySelectorAll("rect[data-cut]").forEach(r => r.remove());

      const nodeIds = [
        "node-center",
        "node-recherche",
        "node-besoin",
        "node-onshape",
        "node-planning",
        "node-medias"
      ];

      for(const id of nodeIds){
        const rr = rectRel(must(id), rootRect);
        const cut = document.createElementNS(SVG_NS, "rect");
        cut.setAttribute("data-cut", id);
        cut.setAttribute("x", String(rr.left - CUT_PAD));
        cut.setAttribute("y", String(rr.top - CUT_PAD));
        cut.setAttribute("width", String(rr.width + 2*CUT_PAD));
        cut.setAttribute("height", String(rr.height + 2*CUT_PAD));
        cut.setAttribute("rx", "22");
        cut.setAttribute("fill", "black"); // noir = ‚Äúcach√©‚Äù
        mask.appendChild(cut);
      }
    }

    // ‚úÖ cr√©e path/circle si manquants
    function ensureSvgFor(id){
      const svg = must("lines");

      let p = document.getElementById(`p-${id}`);
      if(!p){
        p = document.createElementNS(SVG_NS,"path");
        p.setAttribute("id", `p-${id}`);
        p.setAttribute("stroke", "url(#g)");
        p.setAttribute("stroke-width", id === "medias" ? "6.2" : "4.8"); /* un poil plus √©pais */
        p.setAttribute("fill", "none");
        p.setAttribute("filter", "url(#glow)");
        p.setAttribute("stroke-linecap", "round");
        p.setAttribute("stroke-opacity", "1");
        p.setAttribute("mask", "url(#cutNodes)"); /* ‚úÖ ne passe pas sur les cartes */
        svg.appendChild(p);
      }

      let c = document.getElementById(`c-${id}`);
      if(!c){
        c = document.createElementNS(SVG_NS,"circle");
        c.setAttribute("id", `c-${id}`);
        c.setAttribute("r", "4.6");
        c.setAttribute("fill", "#ffffff");
        c.setAttribute("opacity", ".92");
        c.setAttribute("filter", "url(#glow)");
        c.setAttribute("mask", "url(#cutNodes)");
        svg.appendChild(c);
      }
      return {p,c};
    }

    function layoutLines(){
      const map = must('map');
      const svg = must('lines');
      const root = map.getBoundingClientRect();

      svg.setAttribute('viewBox', `0 0 ${root.width} ${root.height}`);
      svg.setAttribute('width', root.width);
      svg.setAttribute('height', root.height);

      // ‚úÖ met √† jour le masque √† CHAQUE layout
      ensureCutMask(root);

      const cRect = rectRel(must('node-center'), root);

      const targets = [
        { id:'recherche', node: must('node-recherche') },
        { id:'besoin',   node: must('node-besoin') },
        { id:'onshape',  node: must('node-onshape') },
        { id:'planning', node: must('node-planning') },
        { id:'medias',   node: must('node-medias') },
      ];

      for(const t of targets){
        const tRect = rectRel(t.node, root);

        let start, end;

        // ‚úÖ branche M√©dias : bas-centre -> haut-centre (garantie visible)
        if (t.id === 'medias') {
          start = { x: cRect.cx, y: cRect.bottom + PAD };
          end   = { x: tRect.cx, y: tRect.top - PAD };
        } else {
          start = edgePoint(cRect, tRect.cx, tRect.cy);
          end   = edgePoint(tRect, cRect.cx, cRect.cy);
        }

        const {p,c} = ensureSvgFor(t.id);
        p.setAttribute('d', bezierPath(start, end));
        c.setAttribute('cx', end.x);
        c.setAttribute('cy', end.y);
      }
    }

    // ‚úÖ plusieurs frames: √©vite le "calcul trop t√¥t" (fonts / layout)
    function stabilize(){
      let n = 0;
      const tick = () => {
        try { layoutLines(); } catch(e){ console.error(e); }
        if(n++ < 18) requestAnimationFrame(tick);
      };
      requestAnimationFrame(tick);
      setTimeout(()=>{ try{layoutLines();}catch(e){console.error(e);} }, 200);
      setTimeout(()=>{ try{layoutLines();}catch(e){console.error(e);} }, 600);
    }

    window.addEventListener('load', stabilize);
    window.addEventListener('resize', stabilize);
  </script>
</body>
</html>
